<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MS Edits - WebCopy Viewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#071014;
      --card:#0f1720;
      --muted:#6b7b8a;
      --text:#dffbf0;
      --accent:#00ff99;
      --accent-2:#00ffd5;
      --accent-strong:#00cc7a;
      --danger:#ff3333;
      --glass: rgba(255,255,255,0.03);
      --radius:8px;
      --shadow: 0 8px 26px rgba(0,0,0,0.6);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(180deg,#041017,#071014 40%);color:var(--text);-webkit-font-smoothing:antialiased}
    .container{max-width:1200px;margin:28px auto;padding:20px}
    header{padding:20px;border-radius:12px;background:linear-gradient(90deg, rgba(0,255,153,0.03), transparent);border:1px solid rgba(0,255,153,0.06);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand {display:flex;flex-direction:column}
    h1{margin:0;font-size:20px;background:linear-gradient(90deg,var(--accent),var(--accent-2));-webkit-background-clip:text;color:transparent;letter-spacing:0.3px}
    .subtitle{margin:6px 0 0 0;color:var(--muted);font-size:13px}
    .top-controls{display:flex;gap:8px;align-items:center}
    .circle-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:var(--text);cursor:pointer;font-weight:600}
    .circle-btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#00110a;border:none}
    main{margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--shadow)}
    .input-row{display:flex;gap:10px;align-items:center}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:#06121a;color:var(--text);outline:none}
    input[type="text"]:focus{box-shadow:0 0 0 4px rgba(0,255,153,0.06);border-color:var(--accent-strong)}
    .fetch-btn{padding:11px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#00110a;font-weight:700;cursor:pointer}
    .status{margin-top:12px;padding:10px;border-radius:8px;display:none;font-weight:600}
    .status.info{display:block;background:rgba(0,255,213,0.06);color:var(--accent-2);border:1px solid rgba(0,255,213,0.08)}
    .status.success{display:block;background:rgba(0,255,153,0.06);color:var(--accent);border:1px solid rgba(0,255,153,0.08)}
    .status.error{display:block;background:rgba(255,51,51,0.06);color:var(--danger);border:1px solid rgba(255,51,51,0.08)}

    /* results */
    .results {margin-top:18px;display:none;gap:12px}
    .row{display:flex;gap:12px;align-items:flex-start}
    .col{flex:1;min-width:0}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .card-title{font-weight:700;color:var(--accent);display:flex;gap:8px;align-items:center}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 10px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:var(--text-muted);cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#00110a}
    .btn.secondary{background:rgba(0,255,213,0.06);color:var(--accent-2)}
    .rawpre{background:#020607;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-family:var(--mono);font-size:13px;color:#bfffe9;max-height:420px;overflow:auto;white-space:pre-wrap}
    .kv{display:flex;gap:10px;margin:6px 0;align-items:flex-start}
    .k{min-width:140px;color:var(--accent);font-weight:700;display:flex;gap:8px;align-items:center}
    .emoji{width:20px;text-align:center}
    .v{flex:1;background:var(--glass);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-family:var(--mono);white-space:pre-wrap;word-break:break-word;color:var(--text);font-size:13px}

    details.collapsible summary{list-style:none;cursor:pointer;padding:8px;border-radius:8px;background:linear-gradient(90deg, rgba(0,255,153,0.03), transparent);display:flex;justify-content:space-between;align-items:center;font-weight:700;color:var(--accent)}
    details.collapsible{margin-top:6px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
    .inner-list{padding:8px;display:flex;flex-direction:column;gap:8px}

    footer{margin-top:22px;color:var(--muted);text-align:center;font-size:13px}

    @media (max-width:900px){
      .row{flex-direction:column}
      .k{min-width:120px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <h1 id="brandTitle">MS Edits - WebCopy Viewer</h1>
        <div class="subtitle" id="brandSubtitle">Paste a URL and fetch site data — JSON with collapsible sections.</div>
      </div>

      <div class="top-controls" role="toolbar" aria-label="top controls">
        <button id="langToggle" class="circle-btn" title="Toggle language">اردو</button>
        <button id="themeToggle" class="circle-btn" title="Toggle theme">Theme</button>
      </div>
    </header>

    <main>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <h3 style="margin:0 0 8px 0">Fetch Website Data</h3>
            <div style="color:var(--muted);font-size:13px">Enter a URL to extract metadata, content and technical info.</div>
          </div>
          <div style="min-width:240px;display:flex;gap:8px;align-items:center">
            <div style="display:flex;gap:8px;width:100%">
              <input id="urlInput" type="text" placeholder="https://example.com" value="https://legendxdata.site/index.html" aria-label="website url">
              <button id="fetchBtn" class="fetch-btn" aria-label="Fetch Data">Fetch Data ⚡</button>
            </div>
          </div>
        </div>

        <div id="statusBox" class="status info" role="status" aria-live="polite" style="margin-top:12px;display:none"></div>

        <div class="results" id="resultsArea">
          <div class="row">
            <div class="col">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Response Data</div>
                  <div class="controls">
                    <button id="copyBtn" class="btn primary">Copy JSON</button>
                    <button id="downloadBtn" class="btn secondary">Download JSON</button>
                    <button id="collapseAll" class="btn">Collapse All</button>
                    <button id="expandAll" class="btn">Expand All</button>
                  </div>
                </div>
                <div class="card-body" id="jsonArea" style="padding:12px"></div>
              </div>
            </div>

            <div class="col" style="max-width:420px">
              <div class="card">
                <div class="card-header">
                  <div class="card-title">Raw JSON Data</div>
                </div>
                <div class="card-body">
                  <div id="rawJson" class="rawpre"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="errorArea" style="margin-top:12px;display:none">
          <div class="card" style="border-color:rgba(255,51,51,0.06)">
            <div class="card-header">
              <div class="card-title" style="color:var(--danger)">Error</div>
            </div>
            <div class="card-body">
              <div id="errMsg" class="v" style="background:rgba(255,51,51,0.03);color:var(--danger)"></div>
            </div>
          </div>
        </div>

      </div>
    </main>

    <footer>
      <div id="footerText">MS Edits - WebCopy Viewer © <span id="year"></span></div>
    </footer>
  </div>

  <script>
    // ----- Translations -----
    const TRANSLATIONS = {
      en: {
        brandTitle: 'MS Edits - WebCopy Viewer',
        brandSubtitle: 'Paste a URL and fetch site data — JSON with collapsible sections.',
        fetchBtn: 'Fetch Data ⚡',
        statusFetching: '⏳ Fetching data...',
        statusSuccess: '✅ Data fetched successfully',
        statusFail: '⚠ Failed to fetch data',
        copySuccess: 'Raw JSON copied to clipboard ✅',
        copyFail: 'Copy failed — maybe browser denied clipboard.',
        downloadName: (ts)=>`msedits_response_${ts}.json`,
        noUrl: 'Please enter a URL first!',
        invalidJson: 'Invalid JSON from API — showing raw response.',
        errorGeneric: 'An error occurred. See details below.',
        collapseAll: 'Collapse All',
        expandAll: 'Expand All',
        copyJson: 'Copy JSON',
        downloadJson: 'Download JSON',
        rawJsonTitle: 'Raw JSON Data',
        responseTitle: 'Response Data',
        footer: 'MS Edits - WebCopy Viewer © '
      },
      ur: {
        brandTitle: 'MS Edits - WebCopy Viewer',
        brandSubtitle: 'ایک یو آر ایل پیسٹ کریں اور ویب سائٹ کا ڈیٹا حاصل کریں — JSON collapsible حصوں کے ساتھ۔',
        fetchBtn: 'ڈیٹا حاصل کریں ⚡',
        statusFetching: '⏳ ڈیٹا حاصل کیا جا رہا ہے...',
        statusSuccess: '✅ ڈیٹا کامیابی سے حاصل ہو گیا',
        statusFail: '⚠ ڈیٹا حاصل کرنے میں ناکامی',
        copySuccess: 'کچا JSON کلپ بورڈ پر کاپی ہوگیا ✅',
        copyFail: 'کاپی ناکام — براؤزر نے اجازت نہیں دی۔',
        downloadName: (ts)=>`msedits_response_${ts}.json`,
        noUrl: 'براہ کرم پہلے یو آر ایل درج کریں!',
        invalidJson: 'API سے غلط JSON موصول ہوا — خام متن دکھایا جا رہا ہے۔',
        errorGeneric: 'کوئی خرابی واقع ہوئی۔ تفصیلات نیچے دیکھیں۔',
        collapseAll: 'تمام بند کریں',
        expandAll: 'تمام کھولیں',
        copyJson: 'JSON کاپی کریں',
        downloadJson: 'JSON ڈاؤن لوڈ کریں',
        rawJsonTitle: 'خام JSON ڈیٹا',
        responseTitle: 'جواب کا ڈیٹا',
        footer: 'MS Edits - WebCopy Viewer © '
      }
    };

    // ----- Emoji map (same as before, concise) -----
    const EMOJI_MAP = {
      ok: "✅", url: "🌐", final_url: "🔗", http_code: "📡",
      contentType: "🧾", content_length: "📏", truncated: "✂",
      title: "🏷", content: "📄", resolved_ips: "🛰", redirect_chain: "↪",
      meta_info: "🧩", link_info: "🔗📊", text_info: "📝", head_headers: "🧾🔐",
      robots: "🤖", sitemap: "🗺", ssl_info: "🔒", timings: "⏱",
      credit: "🫡", charset: "🔤", words: "🔢", total_links: "🔗",
      primary_ip: "📍", server: "🖥", date: "📅"
    };
    function emojiForKey(key){
      if(!key) return "📦";
      if(EMOJI_MAP[key]) return EMOJI_MAP[key];
      if(/ip|address/i.test(key)) return "📍";
      if(/time|timings|date/i.test(key)) return "⏱";
      if(/content/i.test(key)) return "📄";
      if(/link|url|redirect/i.test(key)) return "🔗";
      if(/code|status|http/i.test(key)) return "📡";
      if(/title|name/i.test(key)) return "🏷";
      if(/length|size/i.test(key)) return "📏";
      if(/ssl|cert|issuer/i.test(key)) return "🔒";
      return "📦";
    }

    // ----- Utility: create nodes -----
    function createKeyValueNode(key, value){
      const wrapper = document.createElement('div');
      wrapper.className = 'kv';

      const k = document.createElement('div'); k.className='k';
      const em = document.createElement('span'); em.className='emoji'; em.textContent = emojiForKey(key);
      const keyLabel = document.createElement('span'); keyLabel.textContent = key;
      k.appendChild(em); k.appendChild(keyLabel);

      const v = document.createElement('div'); v.className='v';

      if(value === null){
        v.textContent = 'null';
      } else if(typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean'){
        v.textContent = String(value);
      } else if(Array.isArray(value)){
        const details = document.createElement('details'); details.open = true; details.className='collapsible';
        const summary = document.createElement('summary'); summary.textContent = `Array [${value.length}]`;
        const inner = document.createElement('div'); inner.className='inner-list';
        value.forEach((it, idx) => {
          inner.appendChild(createKeyValueNode(`[${idx}]`, it));
        });
        details.appendChild(summary); details.appendChild(inner);
        v.appendChild(details);
      } else if(typeof value === 'object'){
        const keys = Object.keys(value || {});
        const details = document.createElement('details'); details.open = true; details.className='collapsible';
        const summary = document.createElement('summary'); summary.textContent = `Object {${keys.length}}`;
        const inner = document.createElement('div'); inner.className='inner-list';
        keys.forEach(k2 => inner.appendChild(createKeyValueNode(k2, value[k2])));
        details.appendChild(summary); details.appendChild(inner);
        v.appendChild(details);
      } else {
        v.textContent = String(value);
      }

      wrapper.appendChild(k); wrapper.appendChild(v);
      return wrapper;
    }

    function renderFullJSON(data, container){
      container.innerHTML = '';
      if(!data || typeof data !== 'object'){
        container.appendChild(createKeyValueNode('response', data));
        return;
      }
      const keys = Object.keys(data);
      keys.forEach(k => container.appendChild(createKeyValueNode(k, data[k])));
    }

    // ----- DOM refs -----
    const urlInput = document.getElementById('urlInput');
    const fetchBtn = document.getElementById('fetchBtn');
    const statusBox = document.getElementById('statusBox');
    const resultsArea = document.getElementById('resultsArea');
    const jsonArea = document.getElementById('jsonArea');
    const rawJson = document.getElementById('rawJson');
    const errMsg = document.getElementById('errMsg');
    const errorArea = document.getElementById('errorArea');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const collapseAllBtn = document.getElementById('collapseAll');
    const expandAllBtn = document.getElementById('expandAll');
    const langToggle = document.getElementById('langToggle');
    const brandTitle = document.getElementById('brandTitle');
    const brandSubtitle = document.getElementById('brandSubtitle');
    const fetchBtnText = fetchBtn;
    const footerText = document.getElementById('footerText');
    const yearSpan = document.getElementById('year');
    const themeToggle = document.getElementById('themeToggle');

    let lastJsonStr = null;
    let currentLang = 'en';

    // set year
    yearSpan.textContent = new Date().getFullYear();

    // ----- language helper -----
    function setLanguage(lang){
      currentLang = lang;
      const t = TRANSLATIONS[lang];
      brandTitle.textContent = t.brandTitle;
      brandSubtitle.textContent = t.brandSubtitle;
      fetchBtn.textContent = t.fetchBtn;
      footerText.textContent = t.footer + new Date().getFullYear();
      document.getElementById('copyBtn').textContent = t.copyJson;
      document.getElementById('downloadBtn').textContent = t.downloadJson;
      document.getElementById('collapseAll').textContent = t.collapseAll;
      document.getElementById('expandAll').textContent = t.expandAll;
      document.querySelector('.card-title') && (document.querySelector('.card-title').textContent = t.responseTitle);
      langToggle.textContent = (lang === 'en') ? 'اردو' : 'English';
      // direction
      document.documentElement.lang = (lang === 'en') ? 'en' : 'ur';
      document.documentElement.dir = (lang === 'en') ? 'ltr' : 'rtl';
    }

    // default
    setLanguage('en');

    // ----- copy/download -----
    copyBtn.addEventListener('click', () => {
      if(!lastJsonStr){
        alert(TRANSLATIONS[currentLang].noUrl);
        return;
      }
      navigator.clipboard.writeText(lastJsonStr).then(()=> {
        alert(TRANSLATIONS[currentLang].copySuccess);
      }).catch(()=> alert(TRANSLATIONS[currentLang].copyFail));
    });

    downloadBtn.addEventListener('click', () => {
      if(!lastJsonStr) { alert(TRANSLATIONS[currentLang].noUrl); return; }
      const blob = new Blob([lastJsonStr], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = TRANSLATIONS[currentLang].downloadName(Date.now());
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    collapseAllBtn.addEventListener('click', ()=> setAllDetails(false));
    expandAllBtn.addEventListener('click', ()=> setAllDetails(true));
    function setAllDetails(open){
      document.querySelectorAll('#jsonArea details').forEach(d => d.open = !!open);
    }

    // ----- fetch logic -----
    fetchBtn.addEventListener('click', doFetch);
    urlInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') doFetch(); });

    async function doFetch(){
      const url = urlInput.value.trim();
      resultsArea.style.display = 'none';
      errorArea.style.display = 'none';
      jsonArea.innerHTML = '';
      rawJson.textContent = '';
      lastJsonStr = null;

      if(!url){
        statusBox.textContent = TRANSLATIONS[currentLang].noUrl;
        statusBox.className = 'status error';
        statusBox.style.display = 'block';
        return;
      }

      statusBox.textContent = TRANSLATIONS[currentLang].statusFetching;
      statusBox.className = 'status info';
      statusBox.style.display = 'block';

      try {
        // API endpoint (keep same as original)
        const apiBase = 'https://legendxdata.site/webcopy.php?url=';
        const fullApi = apiBase + encodeURIComponent(url);

        const resp = await fetch(fullApi, { method: 'GET' });
        const text = await resp.text();

        let data;
        try {
          data = JSON.parse(text);
        } catch(parseErr){
          data = { ok:false, error: TRANSLATIONS[currentLang].invalidJson, raw: text };
        }

        const pretty = JSON.stringify(data, null, 2);
        lastJsonStr = pretty;

        renderFullJSON(data, jsonArea);
        rawJson.textContent = pretty;

        statusBox.textContent = TRANSLATIONS[currentLang].statusSuccess;
        statusBox.className = 'status success';
        statusBox.style.display = 'block';
        resultsArea.style.display = 'flex';
        errorArea.style.display = 'none';
      } catch(err){
        statusBox.textContent = TRANSLATIONS[currentLang].statusFail;
        statusBox.className = 'status error';
        statusBox.style.display = 'block';
        errorArea.style.display = 'block';
        errMsg.textContent = String(err);
        console.error(err);
      }
    }

    // ----- language toggle -----
    langToggle.addEventListener('click', ()=>{
      setLanguage(currentLang === 'en' ? 'ur' : 'en');
    });

    // ----- light/dark basic toggle (keeps neon theme) -----
    themeToggle.addEventListener('click', ()=>{
      const body = document.body;
      if(body.style.filter){
        body.style.filter = '';
        themeToggle.textContent = 'Theme';
      } else {
        body.style.filter = 'brightness(0.95) saturate(1.05)';
        themeToggle.textContent = 'Theme';
      }
    });

    // ----- debug: show JS errors in UI -----
    window.addEventListener('error', (e) => {
      console.error(e.error || e);
      statusBox.textContent = TRANSLATIONS[currentLang].errorGeneric;
      statusBox.className = 'status error';
      statusBox.style.display = 'block';
    });

    // Accessibility: announce status changes
    const statusObserver = new MutationObserver(() => {
      statusBox.setAttribute('aria-live', 'polite');
    });
    statusObserver.observe(statusBox, { childList: true, subtree: true });
  </script>
</body>
</html>
